{"timestamp": "2025-09-07 16:46:38,562", "level": "INFO", "name": "planner", "message": "Webhook event received", "payload": {"object": "page", "entry": [{"time": 1757263599144, "id": "101535298270622", "messaging": [{"sender": {"id": "8638633942922586"}, "recipient": {"id": "101535298270622"}, "timestamp": 1757263598368, "message": {"mid": "m_E3dWnKkJB0G4RgDPcxHd4a1CNCTZ89VmFXufFqhIT6PENL4sh61fxI0kEUnqVdOOIMlmH7iF2akUgEi3foy0qA", "text": "."}}]}]}}
{"timestamp": "2025-09-07 16:46:38,564", "level": "INFO", "name": "planner", "message": "User text message", "sender_id": "8638633942922586", "text": "."}
{"timestamp": "2025-09-07 16:46:38,566", "level": "DEBUG", "name": "planner", "message": "Outgoing FB message", "recipient": "8638633942922586", "text": "Khách iu vui lòng đợi chút ạ."}
{"timestamp": "2025-09-07 16:46:42,498", "level": "INFO", "name": "planner", "message": "FB send response", "status": 200, "body": "{\"recipient_id\":\"8638633942922586\",\"message_id\":\"m_33zCRHZSrDUTLae8ANVxea1CNCTZ89VmFXufFqhIT6NvuerCPTz2wz1z88SKcy9EgrpZjExUx1S0_XeU3LRHHg\"}"}
{"timestamp": "2025-09-07 16:46:51,339", "level": "ERROR", "name": "planner", "message": "Agent client error", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/httpx/_transports/default.py\", line 101, in map_httpcore_exceptions\n    yield\n  File \"/usr/local/lib/python3.11/site-packages/httpx/_transports/default.py\", line 394, in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/httpcore/_async/connection_pool.py\", line 256, in handle_async_request\n    raise exc from None\n  File \"/usr/local/lib/python3.11/site-packages/httpcore/_async/connection_pool.py\", line 236, in handle_async_request\n    response = await connection.handle_async_request(\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/httpcore/_async/connection.py\", line 101, in handle_async_request\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/httpcore/_async/connection.py\", line 78, in handle_async_request\n    stream = await self._connect(request)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/httpcore/_async/connection.py\", line 124, in _connect\n    stream = await self._network_backend.connect_tcp(**kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/httpcore/_backends/auto.py\", line 31, in connect_tcp\n    return await self._backend.connect_tcp(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/httpcore/_backends/anyio.py\", line 113, in connect_tcp\n    with map_exceptions(exc_map):\n  File \"/usr/local/lib/python3.11/contextlib.py\", line 158, in __exit__\n    self.gen.throw(typ, value, traceback)\n  File \"/usr/local/lib/python3.11/site-packages/httpcore/_exceptions.py\", line 14, in map_exceptions\n    raise to_exc(exc) from exc\nhttpcore.ConnectError: All connection attempts failed\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/agent_client.py\", line 55, in _get_or_create_thread\n    thread = await self.client.threads.create(\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/langgraph_sdk/client.py\", line 1247, in create\n    return await self.http.post(\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/langgraph_sdk/client.py\", line 315, in post\n    r = await self.client.post(\n        ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/httpx/_client.py\", line 1859, in post\n    return await self.request(\n           ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/httpx/_client.py\", line 1540, in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/httpx/_client.py\", line 1629, in send\n    response = await self._send_handling_auth(\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/httpx/_client.py\", line 1657, in _send_handling_auth\n    response = await self._send_handling_redirects(\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/httpx/_client.py\", line 1694, in _send_handling_redirects\n    response = await self._send_single_request(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/httpx/_client.py\", line 1730, in _send_single_request\n    response = await transport.handle_async_request(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/httpx/_transports/default.py\", line 393, in handle_async_request\n    with map_httpcore_exceptions():\n  File \"/usr/local/lib/python3.11/contextlib.py\", line 158, in __exit__\n    self.gen.throw(typ, value, traceback)\n  File \"/usr/local/lib/python3.11/site-packages/httpx/_transports/default.py\", line 118, in map_httpcore_exceptions\n    raise mapped_exc(message) from exc\nhttpx.ConnectError: All connection attempts failed\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app.py\", line 138, in handle_webhook\n    thread_id, ai_msg = await agent_client.chat(\n                        ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/agent_client.py\", line 42, in chat\n    thread_id = await self._get_or_create_thread(thread_id)\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/agent_client.py\", line 60, in _get_or_create_thread\n    raise RuntimeError(f\"Failed to create thread at thread_id {e}\") from e\nRuntimeError: Failed to create thread at thread_id All connection attempts failed"}
{"timestamp": "2025-09-07 16:46:52,018", "level": "DEBUG", "name": "planner", "message": "Outgoing FB message", "recipient": "8638633942922586", "text": "Có lỗi xảy ra, bạn vui lòng thử lại nhé!"}
{"timestamp": "2025-09-07 16:46:53,418", "level": "INFO", "name": "planner", "message": "FB send response", "status": 200, "body": "{\"recipient_id\":\"8638633942922586\",\"message_id\":\"m_hsZwzYbw-G03h9ajHY7WlK1CNCTZ89VmFXufFqhIT6OoX8oJA47H9UP6he3fb6TKIbPMNf4fdiKArlWiLE5Bfg\"}"}
{"timestamp": "2025-09-07 16:52:52,660", "level": "INFO", "name": "planner", "message": "Webhook event received", "payload": {"entry": [{"id": "0", "time": 1757263972, "changes": [{"field": "feed", "value": {"item": "status", "post_id": "44444444_444444444", "verb": "add", "published": 1, "created_time": 1757263972, "message": "Example post content.", "from": {"name": "Test Page", "id": "1067280970047460"}}}]}], "object": "page"}}
{"timestamp": "2025-09-07 17:03:11,359", "level": "DEBUG", "name": "planner", "message": "Webhook verification attempt", "query": {"hub.mode": "subscribe", "hub.challenge": "1190723268", "hub.verify_token": "dummy_text"}}
{"timestamp": "2025-09-07 17:03:11,360", "level": "INFO", "name": "planner", "message": "Webhook verified successfully"}
{"timestamp": "2025-09-07 17:11:12,598", "level": "DEBUG", "name": "planner", "message": "Webhook verification attempt", "query": {"hub.mode": "subscribe", "hub.challenge": "756158683", "hub.verify_token": "dummy_text"}}
{"timestamp": "2025-09-07 17:11:12,599", "level": "INFO", "name": "planner", "message": "Webhook verified successfully"}
{"timestamp": "2025-09-07 17:18:33,111", "level": "INFO", "name": "planner", "message": "Webhook event received", "payload": {"object": "page", "entry": [{"time": 1757265513466, "id": "101535298270622", "messaging": [{"sender": {"id": "8638633942922586"}, "recipient": {"id": "101535298270622"}, "timestamp": 1757265511993, "message": {"mid": "m_Rc2-bOBy7EYHkIdUqNmF2K1CNCTZ89VmFXufFqhIT6PHrGGL-u4qQv8prwNnQQsI1j3-IkHxAweBruB0ohrzWA", "text": "hi", "nlpv2": {"detected_locales": [{"locale": "en_XX", "confidence": 0.4013}]}}}]}]}}
{"timestamp": "2025-09-07 17:18:33,113", "level": "INFO", "name": "planner", "message": "User text message", "sender_id": "8638633942922586", "text": "hi"}
{"timestamp": "2025-09-07 17:18:33,114", "level": "DEBUG", "name": "planner", "message": "Outgoing FB message", "recipient": "8638633942922586", "text": "Khách iu vui lòng đợi chút ạ."}
{"timestamp": "2025-09-07 17:18:33,953", "level": "INFO", "name": "planner", "message": "FB send response", "status": 200, "body": "{\"recipient_id\":\"8638633942922586\",\"message_id\":\"m_GxV_KT8s_3TRXg0UypPTIK1CNCTZ89VmFXufFqhIT6PJHk726z4rolVozj4wRgoJankFlpWXbKzm467v4u-60A\"}"}
{"timestamp": "2025-09-07 17:18:41,502", "level": "ERROR", "name": "planner", "message": "Agent client error", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/httpx/_transports/default.py\", line 101, in map_httpcore_exceptions\n    yield\n  File \"/usr/local/lib/python3.11/site-packages/httpx/_transports/default.py\", line 394, in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/httpcore/_async/connection_pool.py\", line 256, in handle_async_request\n    raise exc from None\n  File \"/usr/local/lib/python3.11/site-packages/httpcore/_async/connection_pool.py\", line 236, in handle_async_request\n    response = await connection.handle_async_request(\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/httpcore/_async/connection.py\", line 101, in handle_async_request\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/httpcore/_async/connection.py\", line 78, in handle_async_request\n    stream = await self._connect(request)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/httpcore/_async/connection.py\", line 124, in _connect\n    stream = await self._network_backend.connect_tcp(**kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/httpcore/_backends/auto.py\", line 31, in connect_tcp\n    return await self._backend.connect_tcp(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/httpcore/_backends/anyio.py\", line 113, in connect_tcp\n    with map_exceptions(exc_map):\n  File \"/usr/local/lib/python3.11/contextlib.py\", line 158, in __exit__\n    self.gen.throw(typ, value, traceback)\n  File \"/usr/local/lib/python3.11/site-packages/httpcore/_exceptions.py\", line 14, in map_exceptions\n    raise to_exc(exc) from exc\nhttpcore.ConnectError: All connection attempts failed\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/agent_client.py\", line 55, in _get_or_create_thread\n    thread = await self.client.threads.create(\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/langgraph_sdk/client.py\", line 1247, in create\n    return await self.http.post(\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/langgraph_sdk/client.py\", line 315, in post\n    r = await self.client.post(\n        ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/httpx/_client.py\", line 1859, in post\n    return await self.request(\n           ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/httpx/_client.py\", line 1540, in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/httpx/_client.py\", line 1629, in send\n    response = await self._send_handling_auth(\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/httpx/_client.py\", line 1657, in _send_handling_auth\n    response = await self._send_handling_redirects(\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/httpx/_client.py\", line 1694, in _send_handling_redirects\n    response = await self._send_single_request(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/httpx/_client.py\", line 1730, in _send_single_request\n    response = await transport.handle_async_request(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/httpx/_transports/default.py\", line 393, in handle_async_request\n    with map_httpcore_exceptions():\n  File \"/usr/local/lib/python3.11/contextlib.py\", line 158, in __exit__\n    self.gen.throw(typ, value, traceback)\n  File \"/usr/local/lib/python3.11/site-packages/httpx/_transports/default.py\", line 118, in map_httpcore_exceptions\n    raise mapped_exc(message) from exc\nhttpx.ConnectError: All connection attempts failed\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app.py\", line 138, in handle_webhook\n    thread_id, ai_msg = await agent_client.chat(\n                        ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/agent_client.py\", line 42, in chat\n    thread_id = await self._get_or_create_thread(thread_id)\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/agent_client.py\", line 60, in _get_or_create_thread\n    raise RuntimeError(f\"Failed to create thread at thread_id {e}\") from e\nRuntimeError: Failed to create thread at thread_id All connection attempts failed"}
{"timestamp": "2025-09-07 17:18:41,517", "level": "DEBUG", "name": "planner", "message": "Outgoing FB message", "recipient": "8638633942922586", "text": "Có lỗi xảy ra, bạn vui lòng thử lại nhé!"}
{"timestamp": "2025-09-07 17:18:42,256", "level": "INFO", "name": "planner", "message": "FB send response", "status": 200, "body": "{\"recipient_id\":\"8638633942922586\",\"message_id\":\"m_GJlXeFJ-5Lbmbr55EOpD161CNCTZ89VmFXufFqhIT6PpmmK6nnGWQptmuiwRGAvfyA3VequUwDQnpEVF5PkRkw\"}"}
{"timestamp": "2025-09-09 10:26:57,650", "level": "DEBUG", "name": "planner", "message": "Webhook verification attempt", "query": {"hub.mode": "subscribe", "hub.challenge": "938736724", "hub.verify_token": "dummy_text"}}
{"timestamp": "2025-09-09 10:26:57,670", "level": "INFO", "name": "planner", "message": "Webhook verified successfully"}
{"timestamp": "2025-09-09 10:30:25,876", "level": "INFO", "name": "planner", "message": "Webhook event received", "payload": {"object": "page", "entry": [{"time": 1757413826286, "id": "101535298270622", "messaging": [{"sender": {"id": "8638633942922586"}, "recipient": {"id": "101535298270622"}, "timestamp": 1757413825212, "message": {"mid": "m_7taKZ1SALzFjt-kkdy9iO61CNCTZ89VmFXufFqhIT6PrI7YS0_3sqWdhwBPw1cowvj5MlXMO8Hx0ypQpp7l17Q", "text": "yo", "nlpv2": {"detected_locales": [{"locale": "en_XX", "confidence": 0.4464}]}}}]}]}}
{"timestamp": "2025-09-09 10:30:25,877", "level": "INFO", "name": "planner", "message": "User text message", "sender_id": "8638633942922586", "text": "yo"}
{"timestamp": "2025-09-09 10:30:25,878", "level": "DEBUG", "name": "planner", "message": "Outgoing FB message", "recipient": "8638633942922586", "text": "Khách iu vui lòng đợi chút ạ."}
{"timestamp": "2025-09-09 10:30:28,999", "level": "INFO", "name": "planner", "message": "FB send response", "status": 200, "body": "{\"recipient_id\":\"8638633942922586\",\"message_id\":\"m_CB5QKVZUUNUziqMjiTmyD61CNCTZ89VmFXufFqhIT6PxZwoCscTf9lldVxmgsOyD6p1ruqJZ7ILVAlTv1lKFkg\"}"}
{"timestamp": "2025-09-09 10:30:29,705", "level": "ERROR", "name": "planner", "message": "Agent client error", "exc_info": "Traceback (most recent call last):\n  File \"/app/app.py\", line 138, in handle_webhook\n    thread_id, ai_msg = await agent_client.chat(\n                        ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/agent_client.py\", line 43, in chat\n    ai_text = await self._run_agent(user_message, thread_id)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/agent_client.py\", line 63, in _run_agent\n    run_result = await self.client.runs.wait(\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/langgraph_sdk/client.py\", line 2450, in wait\n    response = await self.http.post(\n               ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/langgraph_sdk/client.py\", line 328, in post\n    raise e\n  File \"/usr/local/lib/python3.11/site-packages/langgraph_sdk/client.py\", line 321, in post\n    r.raise_for_status()\n  File \"/usr/local/lib/python3.11/site-packages/httpx/_models.py\", line 829, in raise_for_status\n    raise HTTPStatusError(message, request=request, response=self)\nhttpx.HTTPStatusError: Client error '422 Unprocessable Entity' for url 'http://host.docker.internal:2024/threads/37832cf3-e0be-4f28-95bb-eaa82d954895/runs/wait'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422\nInvalid assistant: 'search_agent'. Must be either:\n- A valid assistant UUID, or\n- One of the registered graphs: re_act_agent"}
{"timestamp": "2025-09-09 10:30:29,854", "level": "DEBUG", "name": "planner", "message": "Outgoing FB message", "recipient": "8638633942922586", "text": "Có lỗi xảy ra, bạn vui lòng thử lại nhé!"}
{"timestamp": "2025-09-09 10:30:30,596", "level": "INFO", "name": "planner", "message": "FB send response", "status": 200, "body": "{\"recipient_id\":\"8638633942922586\",\"message_id\":\"m_ug7mMdcxpGpbfoqiwMoHzK1CNCTZ89VmFXufFqhIT6PwTUUEQfIAujU8NgdHFwcqSQxRBdXGfxJ66D-edK5NXw\"}"}
{"timestamp": "2025-09-09 10:31:16,027", "level": "INFO", "name": "planner", "message": "Webhook event received", "payload": {"object": "page", "entry": [{"time": 1757413876636, "id": "101535298270622", "messaging": [{"sender": {"id": "8638633942922586"}, "recipient": {"id": "101535298270622"}, "timestamp": 1757413875590, "message": {"mid": "m_6HfGs5FWwgxAFqppVJvKrq1CNCTZ89VmFXufFqhIT6PIayV04jeqiW0PGCjr0g2r7Ip3iLST0oMvnO6IZyZauA", "text": "."}}]}]}}
{"timestamp": "2025-09-09 10:31:16,028", "level": "INFO", "name": "planner", "message": "User text message", "sender_id": "8638633942922586", "text": "."}
{"timestamp": "2025-09-09 10:31:16,029", "level": "DEBUG", "name": "planner", "message": "Outgoing FB message", "recipient": "8638633942922586", "text": "Khách iu vui lòng đợi chút ạ."}
{"timestamp": "2025-09-09 10:31:16,989", "level": "INFO", "name": "planner", "message": "FB send response", "status": 200, "body": "{\"recipient_id\":\"8638633942922586\",\"message_id\":\"m_pGf5H-u0sdvsguyK3tnjQq1CNCTZ89VmFXufFqhIT6OX3FdAkA_c5rCwa5WZ-_T2YZkkkqmWo87SX7hvTVmBUA\"}"}
{"timestamp": "2025-09-09 10:31:17,009", "level": "ERROR", "name": "planner", "message": "Agent client error", "exc_info": "Traceback (most recent call last):\n  File \"/app/app.py\", line 138, in handle_webhook\n    thread_id, ai_msg = await agent_client.chat(\n                        ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/agent_client.py\", line 43, in chat\n    ai_text = await self._run_agent(user_message, thread_id)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/agent_client.py\", line 63, in _run_agent\n    run_result = await self.client.runs.wait(\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/langgraph_sdk/client.py\", line 2450, in wait\n    response = await self.http.post(\n               ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/langgraph_sdk/client.py\", line 328, in post\n    raise e\n  File \"/usr/local/lib/python3.11/site-packages/langgraph_sdk/client.py\", line 321, in post\n    r.raise_for_status()\n  File \"/usr/local/lib/python3.11/site-packages/httpx/_models.py\", line 829, in raise_for_status\n    raise HTTPStatusError(message, request=request, response=self)\nhttpx.HTTPStatusError: Client error '422 Unprocessable Entity' for url 'http://host.docker.internal:2024/threads/864d4831-b409-4b88-bdcf-e7c56c60aad1/runs/wait'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422\nInvalid assistant: 'search_agent'. Must be either:\n- A valid assistant UUID, or\n- One of the registered graphs: re_act_agent"}
{"timestamp": "2025-09-09 10:31:17,019", "level": "DEBUG", "name": "planner", "message": "Outgoing FB message", "recipient": "8638633942922586", "text": "Có lỗi xảy ra, bạn vui lòng thử lại nhé!"}
{"timestamp": "2025-09-09 10:31:17,917", "level": "INFO", "name": "planner", "message": "FB send response", "status": 200, "body": "{\"recipient_id\":\"8638633942922586\",\"message_id\":\"m_L_bDhtxj036ycdTPyyY7dK1CNCTZ89VmFXufFqhIT6PmpQyMYKi940fXMzUS6Luird0auXlzDXBPVFU0krjGoA\"}"}
{"timestamp": "2025-09-09 10:34:41,330", "level": "INFO", "name": "planner", "message": "Webhook event received", "payload": {"object": "page", "entry": [{"time": 1757414083034, "id": "101535298270622", "messaging": [{"sender": {"id": "8638633942922586"}, "recipient": {"id": "101535298270622"}, "timestamp": 1757414082428, "message": {"mid": "m_ScRUjjo5HuAqZ53VK2gUFK1CNCTZ89VmFXufFqhIT6NIWSTGe4BpLg3BSnrj04WOjGyP65CG4dopTo_8Vs1kHQ", "text": "hello mấy cưng", "nlpv2": {"detected_locales": [{"locale": "vi_VN", "confidence": 1}]}}}]}]}}
{"timestamp": "2025-09-09 10:34:41,332", "level": "INFO", "name": "planner", "message": "User text message", "sender_id": "8638633942922586", "text": "hello mấy cưng"}
{"timestamp": "2025-09-09 10:34:41,334", "level": "DEBUG", "name": "planner", "message": "Outgoing FB message", "recipient": "8638633942922586", "text": "Khách iu vui lòng đợi chút ạ."}
{"timestamp": "2025-09-09 10:34:44,631", "level": "INFO", "name": "planner", "message": "FB send response", "status": 200, "body": "{\"recipient_id\":\"8638633942922586\",\"message_id\":\"m_PcA-iwxXgL8QiUPlgz7O5a1CNCTZ89VmFXufFqhIT6NwjhrBPshwd_pMP7aVRZbORUp07O0F0lJGfjb3ZLLxFA\"}"}
{"timestamp": "2025-09-09 10:35:00,391", "level": "DEBUG", "name": "planner", "message": "Outgoing FB message", "recipient": "8638633942922586", "text": "Chào bạn! 😊 Bạn đang tìm điện thoại nào? Hãy chia sẻ nhu cầu của bạn (thương hiệu ưa thích, tính năng cần thiết như camera/pin, ngân sách) để mình giới thiệu sản phẩm phù hợp nhất nhé!"}
{"timestamp": "2025-09-09 10:35:01,172", "level": "INFO", "name": "planner", "message": "FB send response", "status": 200, "body": "{\"recipient_id\":\"8638633942922586\",\"message_id\":\"m_Ryc0orguLSRAXZWmBocwTK1CNCTZ89VmFXufFqhIT6O2tUh8rnYzouKHJAmZatbhPvnHaCeVO7_pkVofacIkGg\"}"}
{"timestamp": "2025-09-09 10:35:18,059", "level": "INFO", "name": "planner", "message": "Webhook event received", "payload": {"object": "page", "entry": [{"time": 1757414117587, "id": "101535298270622", "messaging": [{"sender": {"id": "8638633942922586"}, "recipient": {"id": "101535298270622"}, "timestamp": 1757414116723, "message": {"mid": "m_gZfh4q7gHmlrDkSoO9syDa1CNCTZ89VmFXufFqhIT6NhjfV8zUZeKvc9m88ksszzV-kMqUZIsz7T_eFlUTHzWQ", "text": "iphone nhỏ gọn, tầm giá 10tr", "nlpv2": {"detected_locales": [{"locale": "vi_VN", "confidence": 1}]}}}]}]}}
{"timestamp": "2025-09-09 10:35:18,060", "level": "INFO", "name": "planner", "message": "User text message", "sender_id": "8638633942922586", "text": "iphone nhỏ gọn, tầm giá 10tr"}
{"timestamp": "2025-09-09 10:35:18,061", "level": "DEBUG", "name": "planner", "message": "Outgoing FB message", "recipient": "8638633942922586", "text": "Khách iu vui lòng đợi chút ạ."}
{"timestamp": "2025-09-09 10:35:19,069", "level": "INFO", "name": "planner", "message": "FB send response", "status": 200, "body": "{\"recipient_id\":\"8638633942922586\",\"message_id\":\"m_sZi2fcFSpQDTFKBDVkq73K1CNCTZ89VmFXufFqhIT6PVxd6sAFYNvSJTTxz1vsdZVDUQ_s2xp7m9Wldc1qFRuA\"}"}
{"timestamp": "2025-09-09 10:35:38,113", "level": "INFO", "name": "planner", "message": "Webhook event received", "payload": {"object": "page", "entry": [{"time": 1757414139183, "id": "101535298270622", "messaging": [{"sender": {"id": "8638633942922586"}, "recipient": {"id": "101535298270622"}, "timestamp": 1757414116723, "message": {"mid": "m_gZfh4q7gHmlrDkSoO9syDa1CNCTZ89VmFXufFqhIT6NhjfV8zUZeKvc9m88ksszzV-kMqUZIsz7T_eFlUTHzWQ", "text": "iphone nhỏ gọn, tầm giá 10tr", "nlpv2": {"detected_locales": [{"locale": "vi_VN", "confidence": 1}]}}}]}]}}
{"timestamp": "2025-09-09 10:35:38,114", "level": "WARNING", "name": "planner", "message": "Duplicate mid dropped", "mid": "m_gZfh4q7gHmlrDkSoO9syDa1CNCTZ89VmFXufFqhIT6NhjfV8zUZeKvc9m88ksszzV-kMqUZIsz7T_eFlUTHzWQ"}
{"timestamp": "2025-09-09 10:35:52,847", "level": "DEBUG", "name": "planner", "message": "Outgoing FB message", "recipient": "8638633942922586", "text": "iPhone 13 mini chính là \"át chủ bài\" cho bạn! 💯 Màn hình 5.4 inch siêu nhỏ gọn, chip A15 mạnh mẽ, camera kép 12MP. Hiện tại tại HoangHa Mobile có hàng cũ 99%:  \n- **128GB: 8.399 triệu** (tiết kiệm 1.6 triệu so với máy mới)  \n- **256GB: 8.999 triệu** (dư dung lượng, chụp ảnh thoải mái)  \n🎁 Tặng kính cường lực + ốp lưng cao cấp khi mua ngay hôm nay. Bạn muốn xem ảnh thật hoặc check máy trực tiếp không ạ? 😊"}
{"timestamp": "2025-09-09 10:35:54,383", "level": "INFO", "name": "planner", "message": "FB send response", "status": 200, "body": "{\"recipient_id\":\"8638633942922586\",\"message_id\":\"m_y5nLRV6ZLl-VWhY9aGOGIq1CNCTZ89VmFXufFqhIT6Oo6Id8FNRbGg-TQ4nUp--6hFBwZ53Li4Ij8V_QFvA-ig\"}"}
{"timestamp": "2025-09-09 10:36:36,533", "level": "INFO", "name": "planner", "message": "Webhook event received", "payload": {"object": "page", "entry": [{"time": 1757414197250, "id": "101535298270622", "messaging": [{"sender": {"id": "8638633942922586"}, "recipient": {"id": "101535298270622"}, "timestamp": 1757414196315, "message": {"mid": "m_AygIQgrKcp8JA_nWXdcB761CNCTZ89VmFXufFqhIT6PjQBhhW4akis7v-Em2LZSWMCue3EL81Ljs83Yhm38EHA", "text": "mai tới xem", "nlpv2": {"detected_locales": [{"locale": "vi_VN", "confidence": 1}]}}}]}]}}
{"timestamp": "2025-09-09 10:36:36,535", "level": "INFO", "name": "planner", "message": "User text message", "sender_id": "8638633942922586", "text": "mai tới xem"}
{"timestamp": "2025-09-09 10:36:36,536", "level": "DEBUG", "name": "planner", "message": "Outgoing FB message", "recipient": "8638633942922586", "text": "Khách iu vui lòng đợi chút ạ."}
{"timestamp": "2025-09-09 10:36:37,286", "level": "INFO", "name": "planner", "message": "FB send response", "status": 200, "body": "{\"recipient_id\":\"8638633942922586\",\"message_id\":\"m_YXHJga6nNvezghWXCNGCWq1CNCTZ89VmFXufFqhIT6M-oiD-fY1CNWXDcnTuCgNLSFcqbggRuzNXhdNYzOVO6g\"}"}
{"timestamp": "2025-09-09 10:36:45,899", "level": "DEBUG", "name": "planner", "message": "Outgoing FB message", "recipient": "8638633942922586", "text": "Tuyệt vời! Mình giữ sẵn iPhone 13 mini cho bạn rồi nhé 🛍️ Cửa hàng mở cửa 8h-21h, bạn đến lúc nào tiện nhất? Nhắn giờ giúp mình để check lịch nhé! Đừng quên **quà tặng 2 trong 1** (kính cường lực + ốp lưng) khi mua trong hôm nay nha 😊"}
{"timestamp": "2025-09-09 10:36:46,606", "level": "INFO", "name": "planner", "message": "FB send response", "status": 200, "body": "{\"recipient_id\":\"8638633942922586\",\"message_id\":\"m_2O3ia0ZDf8EdWemkxSgRuK1CNCTZ89VmFXufFqhIT6OPIQFR23unoQ4nmnPTr7aL04hrXy7NnpRR-_bx_ylDxg\"}"}
{"timestamp": "2025-09-09 10:36:58,965", "level": "INFO", "name": "planner", "message": "Webhook event received", "payload": {"object": "page", "entry": [{"time": 1757414218909, "id": "101535298270622", "messaging": [{"sender": {"id": "8638633942922586"}, "recipient": {"id": "101535298270622"}, "timestamp": 1757414218068, "message": {"mid": "m_Oy3vmULWlkbtbA_RnmJjj61CNCTZ89VmFXufFqhIT6M5qxQhC8r4Pp70uy0bCA5alEV-j5tsWzPFACYJXbgZlg", "text": "còn máy khác ko", "nlpv2": {"detected_locales": [{"locale": "vi_VN", "confidence": 1}]}}}]}]}}
{"timestamp": "2025-09-09 10:36:58,967", "level": "INFO", "name": "planner", "message": "User text message", "sender_id": "8638633942922586", "text": "còn máy khác ko"}
{"timestamp": "2025-09-09 10:36:58,968", "level": "DEBUG", "name": "planner", "message": "Outgoing FB message", "recipient": "8638633942922586", "text": "Khách iu vui lòng đợi chút ạ."}
{"timestamp": "2025-09-09 10:36:59,879", "level": "INFO", "name": "planner", "message": "FB send response", "status": 200, "body": "{\"recipient_id\":\"8638633942922586\",\"message_id\":\"m_i3TUuKN7zvQ4ojj-Ar4gZK1CNCTZ89VmFXufFqhIT6Pay_fq6d9pfTxLfvsFi46o79LXVp8rYgMuNfjBQzrSow\"}"}
{"timestamp": "2025-09-09 10:37:18,126", "level": "INFO", "name": "planner", "message": "Webhook event received", "payload": {"object": "page", "entry": [{"time": 1757414239528, "id": "101535298270622", "messaging": [{"sender": {"id": "8638633942922586"}, "recipient": {"id": "101535298270622"}, "timestamp": 1757414218068, "message": {"mid": "m_Oy3vmULWlkbtbA_RnmJjj61CNCTZ89VmFXufFqhIT6M5qxQhC8r4Pp70uy0bCA5alEV-j5tsWzPFACYJXbgZlg", "text": "còn máy khác ko", "nlpv2": {"detected_locales": [{"locale": "vi_VN", "confidence": 1}]}}}]}]}}
{"timestamp": "2025-09-09 10:37:18,127", "level": "WARNING", "name": "planner", "message": "Duplicate mid dropped", "mid": "m_Oy3vmULWlkbtbA_RnmJjj61CNCTZ89VmFXufFqhIT6M5qxQhC8r4Pp70uy0bCA5alEV-j5tsWzPFACYJXbgZlg"}
{"timestamp": "2025-09-09 10:37:26,450", "level": "DEBUG", "name": "planner", "message": "Outgoing FB message", "recipient": "8638633942922586", "text": "Ngoài iPhone 13 mini, mình còn **iPhone 12 mini** (giá chỉ 5.699-6.199 triệu) nhưng chip A14 cũ hơn và camera thường. Trong khi đó, **iPhone 13 mini** (8.399-8.999 triệu) có chip A15 mạnh gấp 1.3 lần, camera chống rung, pin trâu hơn - xứng đáng đầu tư thêm 2-3 triệu để dùng bền lâu! 🔥  \nMình để sẵn cả 2 mẫu cho bạn so sánh trực tiếp nhé. Mai đến check máy, mình còn **tặng thêm sạc nhanh 20W** nữa nha! 😍"}
{"timestamp": "2025-09-09 10:37:27,243", "level": "INFO", "name": "planner", "message": "FB send response", "status": 200, "body": "{\"recipient_id\":\"8638633942922586\",\"message_id\":\"m_OV8u0Ziz9CBdDNUqAHTchq1CNCTZ89VmFXufFqhIT6Ns4tWKXLzX1C3M9IqN3XmxVnhDvn8vXsWSYaCgI7hnsw\"}"}
{"timestamp": "2025-09-09 10:37:53,518", "level": "INFO", "name": "planner", "message": "Webhook event received", "payload": {"object": "page", "entry": [{"time": 1757414275423, "id": "101535298270622", "messaging": [{"sender": {"id": "8638633942922586"}, "recipient": {"id": "101535298270622"}, "timestamp": 1757414274568, "message": {"mid": "m_rY--fz4YhSnRj5CCgz8Hda1CNCTZ89VmFXufFqhIT6NumxVJoLlS38fh-VRCk_PAOM8vXlVO3-432HchRmJCFg", "text": "còn xiaomi", "nlpv2": {"detected_locales": [{"locale": "vi_VN", "confidence": 0.9999}]}}}]}]}}
{"timestamp": "2025-09-09 10:37:53,519", "level": "INFO", "name": "planner", "message": "User text message", "sender_id": "8638633942922586", "text": "còn xiaomi"}
{"timestamp": "2025-09-09 10:37:53,524", "level": "DEBUG", "name": "planner", "message": "Outgoing FB message", "recipient": "8638633942922586", "text": "Khách iu vui lòng đợi chút ạ."}
{"timestamp": "2025-09-09 10:37:55,027", "level": "INFO", "name": "planner", "message": "FB send response", "status": 200, "body": "{\"recipient_id\":\"8638633942922586\",\"message_id\":\"m_iF9lB_YmpW0I0cc4l010LK1CNCTZ89VmFXufFqhIT6OOkL8j2n44JEWXy7UZ-rJ8oyIdnoyNpsWDz8CJ65tXEQ\"}"}
{"timestamp": "2025-09-09 10:38:15,165", "level": "INFO", "name": "planner", "message": "Webhook event received", "payload": {"object": "page", "entry": [{"time": 1757414296038, "id": "101535298270622", "messaging": [{"sender": {"id": "8638633942922586"}, "recipient": {"id": "101535298270622"}, "timestamp": 1757414274568, "message": {"mid": "m_rY--fz4YhSnRj5CCgz8Hda1CNCTZ89VmFXufFqhIT6NumxVJoLlS38fh-VRCk_PAOM8vXlVO3-432HchRmJCFg", "text": "còn xiaomi", "nlpv2": {"detected_locales": [{"locale": "vi_VN", "confidence": 0.9999}]}}}]}]}}
{"timestamp": "2025-09-09 10:38:15,166", "level": "WARNING", "name": "planner", "message": "Duplicate mid dropped", "mid": "m_rY--fz4YhSnRj5CCgz8Hda1CNCTZ89VmFXufFqhIT6NumxVJoLlS38fh-VRCk_PAOM8vXlVO3-432HchRmJCFg"}
{"timestamp": "2025-09-09 10:38:31,661", "level": "DEBUG", "name": "planner", "message": "Outgoing FB message", "recipient": "8638633942922586", "text": "Ngoài iPhone 13 mini, bên mình còn **Xiaomi 13 5G** (9.299 triệu) - máy Android nhỏ nhất phân khúc với màn hình 6.36 inch, chip Snapdragon 8 Gen 2. Tuy nhiên, **iPhone 13 mini** vẫn vượt trội về độ gọn (nhỏ hơn 27%), chip A15 xử lý mượt hơn 35% và camera chỉnh màu chuẩn \"táo\". 🍎  \n👉 **Ưu đãi đặc biệt**: Mua iPhone 13 mini hôm nay, bạn được **tặng ngay sạc nhanh 20W + bảo hành vàng 12 tháng**. Xiaomi 13 chỉ có bảo hành 6 tháng, không kèm quà. Bạn muốn trải nghiệm trực tiếp cả 2 mẫu để cảm nhận sự khác biệt không ạ? 😊"}
{"timestamp": "2025-09-09 10:38:32,588", "level": "INFO", "name": "planner", "message": "FB send response", "status": 200, "body": "{\"recipient_id\":\"8638633942922586\",\"message_id\":\"m_lwbdOdQe26VbFfQuZ-J3-K1CNCTZ89VmFXufFqhIT6OT8cYYUPGhbHKYAIPyVF3GbmM78vwkevt-JRWL2xGCiA\"}"}
{"timestamp": "2025-09-09 11:14:11,296", "level": "INFO", "name": "planner", "message": "Webhook event received", "payload": {"object": "page", "entry": [{"time": 1757416451475, "id": "101535298270622", "messaging": [{"sender": {"id": "8638633942922586"}, "recipient": {"id": "101535298270622"}, "timestamp": 1757416450686, "message": {"mid": "m_5bJ3-cEuNC0EMBamjGvia61CNCTZ89VmFXufFqhIT6ML_2jlyj366ZXLwELFLpYU5iYamIbIiQNElMjrQU7y4g", "text": "hi", "nlpv2": {"detected_locales": [{"locale": "en_XX", "confidence": 0.4014}]}}}]}]}}
{"timestamp": "2025-09-09 11:14:11,302", "level": "INFO", "name": "planner", "message": "User text message", "sender_id": "8638633942922586", "text": "hi"}
{"timestamp": "2025-09-09 11:14:11,304", "level": "DEBUG", "name": "planner", "message": "Outgoing FB message", "recipient": "8638633942922586", "text": "Khách iu vui lòng đợi chút ạ."}
{"timestamp": "2025-09-09 11:14:12,392", "level": "INFO", "name": "planner", "message": "FB send response", "status": 200, "body": "{\"recipient_id\":\"8638633942922586\",\"message_id\":\"m_cv6iTzY_xLziskzGSLsZca1CNCTZ89VmFXufFqhIT6MGmctGf4oNZE5hoUXQn51RukJoqqYGbie2io61DGZPbA\"}"}
{"timestamp": "2025-09-09 11:14:14,313", "level": "ERROR", "name": "planner", "message": "Agent client error", "exc_info": "Traceback (most recent call last):\n  File \"/app/app.py\", line 138, in handle_webhook\n    thread_id, ai_msg = await agent_client.chat(\n                        ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/agent_client.py\", line 43, in chat\n    ai_text = await self._run_agent(user_message, thread_id)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/agent_client.py\", line 63, in _run_agent\n    run_result = await self.client.runs.wait(\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/langgraph_sdk/client.py\", line 2463, in wait\n    raise Exception(\nException: BlockingError: Blocking call to socket.socket.accept\n\nHeads up! LangGraph dev identified a synchronous blocking call in your code. When running in an ASGI web server, blocking calls can degrade performance for everyone since they tie up the event loop.\n\nHere are your options to fix this:\n\n1. Best approach: Convert any blocking code to use async/await patterns\n   For example, use 'await aiohttp.get()' instead of 'requests.get()'\n\n2. Quick fix: Move blocking operations to a separate thread\n   Example: 'await asyncio.to_thread(your_blocking_function)'\n\n3. Override (if you can't change the code):\n   - For development: Run 'langgraph dev --allow-blocking'\n   - For deployment: Set 'BG_JOB_ISOLATED_LOOPS=true' environment variable\n\nThese blocking operations can prevent health checks and slow down other runs in your deployment. Following these recommendations will help keep your LangGraph application running smoothly!"}
{"timestamp": "2025-09-09 11:14:14,364", "level": "DEBUG", "name": "planner", "message": "Outgoing FB message", "recipient": "8638633942922586", "text": "Có lỗi xảy ra, bạn vui lòng thử lại nhé!"}
{"timestamp": "2025-09-09 11:14:15,827", "level": "INFO", "name": "planner", "message": "FB send response", "status": 200, "body": "{\"recipient_id\":\"8638633942922586\",\"message_id\":\"m_85-67wl4mKUcKdiIIOXqrq1CNCTZ89VmFXufFqhIT6OI7q1woBBrhz7VNSdNyhVSoVEeddtuiHJV2yqSIqk-Yg\"}"}
{"timestamp": "2025-09-09 12:13:47,345", "level": "DEBUG", "name": "planner", "message": "Webhook verification attempt", "query": {"hub.mode": "subscribe", "hub.challenge": "1178376256", "hub.verify_token": "dummy_text"}}
{"timestamp": "2025-09-09 12:13:47,348", "level": "INFO", "name": "planner", "message": "Webhook verified successfully"}
